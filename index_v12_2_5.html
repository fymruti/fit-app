<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fit – All-in-One (v12.2.5)</title>
<meta name="app-version" content="12.2.5"/>
<style>
:root{
  --bg:#f2f2f2; --ink:#0f172a; --ink-soft:#475569;
  --accent:#4A90E2; --accent-dark:#357ABD;
  --card:#e0e0e0; --input:#fafafa; --border:#cbd5e1;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f172a; --ink:#f1f5f9; --ink-soft:#94a3b8;
    --accent:#60a5fa; --accent-dark:#2563eb;
    --card:#1f2937; --input:#1e293b; --border:#334155;
  }
}
body.dark{
  --bg:#0f172a; --ink:#f1f5f9; --ink-soft:#94a3b8;
  --accent:#60a5fa; --accent-dark:#2563eb;
  --card:#1f2937; --input:#1e293b; --border:#334155;
}
*{box-sizing:border-box}
body{ margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink); transition:background .3s,color .3s;}
header{ display:grid; grid-template-columns:1fr auto; gap:10px;
  background:linear-gradient(90deg,var(--accent),var(--accent-dark)); color:#fff; padding:10px; position:sticky; top:0; z-index:10; box-shadow:0 3px 6px rgba(0,0,0,.1);}
.tabs{display:flex; gap:8px; flex-wrap:wrap}
.tabs a{ padding:8px 12px; border:none; border-radius:8px; cursor:pointer; background:#fff; color:#1b3f6b; font-weight:600; box-shadow:0 2px 4px rgba(0,0,0,.15); text-decoration:none}
body.dark .tabs a{background:#1e293b; color:#e2e8f0}
.tabs a[aria-current="page"]{background:#1b3f6b; color:#fff}
body.dark .tabs a[aria-current="page"]{background:#60a5fa; color:#0f172a}
.rightbar{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.rightbar button{ border:none; border-radius:8px; padding:6px 8px; cursor:pointer; background:#fff; color:#1b3f6b;}
body.dark .rightbar button{background:#334155; color:#f1f5f9}
.btn{background:#fff; color:#1b3f6b; border:1px solid rgba(255,255,255,.4); border-radius:8px; padding:6px 10px; cursor:pointer}
main{max-width:1180px; margin:0 auto; padding:12px}
.card{ background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 14px rgba(0,0,0,.08); margin-bottom:12px;}
.small{font-size:12px; color:var(--ink-soft)}
main > section{display:none}
main > section#start{display:block}
main > section:target{display:block}
main:has(section:target:not(#start)) > #start{display:none}
</style>
</head>
<body>
<header>
  <nav class="tabs" id="tabs">
    <a href="#start" data-tab="start" aria-current="page">Start</a>
    <a href="#sylwetka" data-tab="sylwetka">Sylwetka</a>
    <a href="#dieta" data-tab="dieta">Dieta</a>
    <a href="#jedzenie" data-tab="jedzenie">Jedzenie</a>
    <a href="#suple" data-tab="suple">Suple</a>
  </nav>
  <div class="rightbar">
    <button id="btnTheme" class="btn" title="Tryb jasny/ciemny">🌙/☀️</button>
    <button id="btnPickDir" class="btn" title="Wybierz folder FIT (Chromium)">📁 Ustaw folder FIT</button>
    <button id="btnSaveReport" class="btn" title="Zapisz raport TXT">📝 Zapisz raport TXT</button>
    <button id="btnDiag" class="btn" title="Panel diagnostyczny">🧪Diag</button>
  </div>
</header>

<main>
  <section id="start">
    <div class="card">
      <h3>Start</h3>
      <div class="small">
        v12.2.5 — Raport TXT + wybór folderu FIT (Chromium).<br>
        Safari/Firefox: pobieranie pliku TXT.
      </div>
    </div>
  </section>
  <section id="sylwetka"><div class="card"><h3>Sylwetka</h3><div class="small">Przykład.</div></div></section>
  <section id="dieta"><div class="card"><h3>Dieta</h3><div class="small">Przykład.</div></div></section>
  <section id="jedzenie"><div class="card"><h3>Jedzenie</h3><div class="small">Przykład.</div></div></section>
  <section id="suple"><div class="card"><h3>Suple</h3><div class="small">Przykład.</div></div></section>
</main>

<script src="stability_v1.js"></script>
<script src="healthcheck_v1.js"></script>
<script>
(function(){
  if(!location.hash){ location.replace('#start'); }
  const KEY='fit_theme_v1', btn=document.getElementById('btnTheme');
  const pref = localStorage.getItem(KEY);
  if(pref==='dark') document.body.classList.add('dark');
  if(pref==='light') document.body.classList.remove('dark');
  FIT_STAB.on(btn,'click',()=>{
    const dark = !document.body.classList.contains('dark');
    document.body.classList.toggle('dark', dark);
    try{ localStorage.setItem(KEY, dark?'dark':'light'); }catch(_){}
    FIT_STAB.log('info','theme toggle',{dark});
  });
  const nav=document.getElementById('tabs');
  function paint(){ const id=(location.hash||'#start').slice(1);
    nav?.querySelectorAll('a').forEach(a=>a.setAttribute('aria-current', a.dataset.tab===id?'page':'false'));
  }
  window.addEventListener('hashchange', paint); paint();
  FIT_STAB.on(document.getElementById('btnDiag'),'click',()=>{
    const url=new URL(location.href); url.searchParams.set('diag','1'); location.href=url.toString();
  });
  let dirHandle = null;
  FIT_STAB.on(document.getElementById('btnPickDir'),'click', async()=>{
    try{
      if(!window.showDirectoryPicker){ alert('Ta przeglądarka nie wspiera wyboru folderu. Użyj Chrome/Edge lub zapisz TXT przez pobieranie.'); return; }
      dirHandle = await window.showDirectoryPicker({id:'fit-folder', mode:'readwrite', startIn:'desktop'});
      FIT_STAB.hud('Wybrano folder FIT'); FIT_STAB.log('info','dir picked',{name:dirHandle.name});
    }catch(e){ FIT_STAB.log('warn','dir pick canceled',{e:String(e)}); }
  });
  FIT_STAB.on(document.getElementById('btnSaveReport'),'click', async()=>{
    try{
      const report = await FIT_HEALTH.buildReport();
      const fname = FIT_HEALTH.buildFilename();
      if(dirHandle){
        try{
          const fhandle = await dirHandle.getFileHandle(fname, {create:true});
          const w = await fhandle.createWritable(); await w.write(report); await w.close();
          FIT_STAB.hud('Zapisano: '+fname); FIT_STAB.log('info','report saved (FS)',{fname});
          return;
        }catch(e){ FIT_STAB.log('warn','fs write fail, fallback to download',{e:String(e)}); }
      }
      const blob = new Blob([report], {type:'text/plain;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = fname;
      document.body.appendChild(a); a.click(); a.remove();
      FIT_STAB.hud('Pobrano: '+fname); FIT_STAB.log('info','report downloaded',{fname});
    }catch(e){
      console.error(e); FIT_STAB.log('error','save report fail',{e:String(e)});
      alert('Nie udało się zapisać raportu.');
    }
  });
  FIT_STAB.log('info','app init ok',{ver: document.querySelector('meta[name=app-version]')?.content||'?'});
})();
</script>
</body>
</html>
